

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Scale benchmarks &mdash; mlens 0.2.2 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato" type="text/css" />
  <link rel="stylesheet" href="../_static/css/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/mlens-theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/sphinx-glr.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Troubleshooting" href="../deep/troubleshooting.html" />
    <link rel="prev" title="Performance benchmarks" href="benchmarks.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.2.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Installation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../start/install.html">Install</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../start/install.html#bleeding-edge">Bleeding edge</a></li>
<li class="toctree-l2"><a class="reference internal" href="../start/install.html#dependencies">Dependencies</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../start/install.html#test-build">Test build</a></li>
</ul>
<p class="caption"><span class="caption-text">High-level API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/start.html">Getting started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/start.html#preliminaries">Preliminaries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/start.html#ensemble-guide">Ensemble guide</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/start.html#building-an-ensemble">Building an ensemble</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/start.html#multi-layer-ensembles">Multi-layer ensembles</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/start.html#model-selection-guide">Model selection guide</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/start.html#the-scoring-function">The scoring function</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/start.html#a-simple-evaluation">A simple evaluation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/start.html#preprocessing">Preprocessing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/start.html#model-selection-across-preprocessing-pipelines">Model Selection across preprocessing pipelines</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/start.html#visualization-guide">Visualization guide</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/advanced.html">Advanced features tutorial</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/advanced.html#propagating-input-features">Propagating input features</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/advanced.html#probabilistic-ensemble-learning">Probabilistic ensemble learning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/advanced.html#advanced-subsemble-techniques">Advanced Subsemble techniques</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/advanced.html#general-multi-layer-ensemble-learning">General multi-layer ensemble learning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/advanced.html#passing-file-paths-as-data-input">Passing file paths as data input</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/advanced.html#ensemble-model-selection">Ensemble model selection</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../start/ensembles.html">Ready-made ensemble classes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../start/ensembles.html#super-learner">Super Learner</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../start/ensembles.html#references">References</a></li>
<li class="toctree-l3"><a class="reference internal" href="../start/ensembles.html#notes">Notes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../start/ensembles.html#subsemble">Subsemble</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../start/ensembles.html#id8">References</a></li>
<li class="toctree-l3"><a class="reference internal" href="../start/ensembles.html#id10">Notes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../start/ensembles.html#blend-ensemble">Blend Ensemble</a></li>
<li class="toctree-l2"><a class="reference internal" href="../start/ensembles.html#sequential-ensemble">Sequential Ensemble</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Mechanics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/learner.html">Learner Mechanics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/learner.html#the-learner-api">The Learner API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/learner.html#basics">Basics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/learner.html#partitioning">Partitioning</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/learner.html#preprocessing">Preprocessing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/learner.html#parallel-estimation">Parallel estimation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/layer.html">Layer Mechanics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/layer.html#the-layer-api">The Layer API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/layer.html#basics">Basics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/layer.html#multitasking">Multitasking</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/layer.html#layer-features">Layer features</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/parallel.html">Parallel Mechanics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/parallel.html#parallelprocessing-api">ParallelProcessing API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/parallel.html#stacking-a-set-of-parallel-jobs">Stacking a set of parallel jobs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/parallel.html#manual-initialization-and-processing">Manual initialization and processing</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/sequential.html">Sequential Mechanics</a></li>
</ul>
<p class="caption"><span class="caption-text">Details</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="memory.html">Memory consumption</a><ul>
<li class="toctree-l2"><a class="reference internal" href="memory.html#memory-mapping">Memory mapping</a></li>
<li class="toctree-l2"><a class="reference internal" href="memory.html#ml-ensemble-memory-profiling">ML-Ensemble memory profiling</a></li>
<li class="toctree-l2"><a class="reference internal" href="memory.html#memory-performance-benchmark">Memory performance benchmark</a></li>
<li class="toctree-l2"><a class="reference internal" href="memory.html#gotcha-s">Gotchaâ€™s</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="benchmarks.html">Performance benchmarks</a><ul>
<li class="toctree-l2"><a class="reference internal" href="benchmarks.html#mnist">MNIST</a><ul>
<li class="toctree-l3"><a class="reference internal" href="benchmarks.html#benchmark">Benchmark</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="benchmarks.html#the-friedman-regression-problem-1">The Friedman Regression Problem 1</a><ul>
<li class="toctree-l3"><a class="reference internal" href="benchmarks.html#id5">Benchmark</a></li>
<li class="toctree-l3"><a class="reference internal" href="benchmarks.html#references">References</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Scale benchmarks</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#single-process-vs-multi-process">Single process vs multi-process</a></li>
<li class="toctree-l2"><a class="reference internal" href="#ensemble-comparison">Ensemble comparison</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../deep/troubleshooting.html">Troubleshooting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../deep/troubleshooting.html#bad-interaction-with-third-party-packages">Bad interaction with third-party packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="../deep/troubleshooting.html#array-copying-during-fitting">Array copying during fitting</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Additional Information</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../misc/license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/updates.html">Change log</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">mlens</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Scale benchmarks</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/benchmarks/scaling.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="scale-benchmarks">
<span id="scaling"></span><h1>Scale benchmarks<a class="headerlink" href="#scale-benchmarks" title="Permalink to this headline">Â¶</a></h1>
<p>The <a class="reference internal" href="#cpu"><span class="std std-ref">Single process vs multi-process</span></a> benchmark compares how running ensembles on a single process fares
against running them on multiple processes.</p>
<p>The <a class="reference internal" href="#bench"><span class="std std-ref">Ensemble comparison</span></a> benchmark compares ensemble classes in terms of time to fit and
predictive power as data scales.</p>
<div class="section" id="single-process-vs-multi-process">
<span id="cpu"></span><h2>Single process vs multi-process<a class="headerlink" href="#single-process-vs-multi-process" title="Permalink to this headline">Â¶</a></h2>
<p>We compare the time to fit the <a class="reference external" href="http://ml-ensemble.com/docs/ensemble.html#mlens.ensemble.SuperLearner" title="(in mlens v0.2.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">SuperLearner</span></code></a> and the
<a class="reference external" href="http://ml-ensemble.com/docs/ensemble.html#mlens.ensemble.BlendEnsemble" title="(in mlens v0.2.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">BlendEnsemble</span></code></a> when run on a single process and when run on four
processes. The ensembles have four SVR base estimators and an SVR as final
meta learner. Hence, while the single-processed ensembles need to fit 5
SVR models consecutively, the multiprocessed ensembles need only the time
equivalent to fit 2 consecutively. As the figure below shows, there are clear
benefits to multi-processing.</p>
<img alt="../_images/scale_cpu.png" class="align-center" src="../_images/scale_cpu.png" />
<p>To replicate the benchmark, in the <code class="docutils literal notranslate"><span class="pre">mlens</span></code> benchmark folder, execute:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">python</span> <span class="n">scale_cpu</span><span class="o">.</span><span class="n">py</span>

<span class="go">ML-ENSEMBLE</span>

<span class="go">Threading performance test for data set dimensioned up to (10000, 50)</span>
<span class="go">Available CPUs: 4</span>

<span class="go">Ensemble architecture</span>
<span class="go">Num layers: 2</span>
<span class="go">Fit per base layer estimator: 2 + 1</span>
<span class="go">layer-1 | Estimators: [&#39;svr-1&#39;, &#39;svr-2&#39;, &#39;svr-3&#39;, &#39;svr-4&#39;].</span>
<span class="go">layer-2 | Meta Estimator: svr</span>

<span class="go">FIT TIMES</span>
<span class="go">samples</span>
<span class="go">   1000 SuperLearner (1) :   0.88s | BlendEnsemble (1) :   0.35s |</span>
<span class="go">   1000 SuperLearner (4) :   0.71s | BlendEnsemble (4) :   0.41s |</span>

<span class="go">   2000 SuperLearner (1) :   2.82s | BlendEnsemble (1) :   0.76s |</span>
<span class="go">   2000 SuperLearner (4) :   1.51s | BlendEnsemble (4) :   0.59s |</span>

<span class="go">   3000 SuperLearner (1) :   6.04s | BlendEnsemble (1) :   1.56s |</span>
<span class="go">   3000 SuperLearner (4) :   2.96s | BlendEnsemble (4) :   0.90s |</span>

<span class="go">   4000 SuperLearner (1) :  10.94s | BlendEnsemble (1) :   2.79s |</span>
<span class="go">   4000 SuperLearner (4) :   7.92s | BlendEnsemble (4) :   1.53s |</span>

<span class="go">   5000 SuperLearner (1) :  18.45s | BlendEnsemble (1) :   4.58s |</span>
<span class="go">   5000 SuperLearner (4) :   8.52s | BlendEnsemble (4) :   2.26s |</span>

<span class="go">   6000 SuperLearner (1) :  27.48s | BlendEnsemble (1) :   7.24s |</span>
<span class="go">   6000 SuperLearner (4) :  15.06s | BlendEnsemble (4) :   3.41s |</span>

<span class="go">   7000 SuperLearner (1) :  38.73s | BlendEnsemble (1) :   8.62s |</span>
<span class="go">   7000 SuperLearner (4) :  18.21s | BlendEnsemble (4) :   4.41s |</span>

<span class="go">   8000 SuperLearner (1) :  52.08s | BlendEnsemble (1) :  12.10s |</span>
<span class="go">   8000 SuperLearner (4) :  23.43s | BlendEnsemble (4) :   4.95s |</span>

<span class="go">   9000 SuperLearner (1) :  61.70s | BlendEnsemble (1) :  14.58s |</span>
<span class="go">   9000 SuperLearner (4) :  28.55s | BlendEnsemble (4) :   8.45s |</span>

<span class="go">  10000 SuperLearner (1) :  75.76s | BlendEnsemble (1) :  18.72s |</span>
<span class="go">  10000 SuperLearner (4) :  32.71s | BlendEnsemble (4) :   7.52s |</span>

<span class="go">Benchmark done | 00:09:00</span>
</pre></div>
</div>
</div>
<div class="section" id="ensemble-comparison">
<span id="bench"></span><h2>Ensemble comparison<a class="headerlink" href="#ensemble-comparison" title="Permalink to this headline">Â¶</a></h2>
<p>We compare the time to fit a Super Learner, Subsemble and Blend ensemble
when run on four processes as data scales from 20 000 to 260 000 observations
with 20 dense real valued features.</p>
<p>Each ensemble has the same set of base learners and meta learners, all
initiated at standard parameter settings. Each model is fitted on half the
observations and predict the other half. The data is generated as per
the Friedman 1 process (see <a class="reference internal" href="benchmarks.html#benchmarks"><span class="std std-ref">Performance benchmarks</span></a>).</p>
<p>The super learner tends to give best performance (rmse), but generally all
classes achieve similar accuracy scores. However, the super learner
(with 2 folds) takes more than twice as long to fit than a
subsemble (with 3 partitions and 2 folds on each partition), and up to
three times as long as the Blend ensemble (with 50% split). The subsemble tends
to perform better than the blend ensemble after 70000 observations and has a
similar fit time. In fact, it can be made more time efficient if the number
of partitions is increased. This can significantly impact optimal meta
learner parameter settings and overall performance.</p>
<img alt="../_images/scale_ens_score.png" class="align-center" src="../_images/scale_ens_score.png" />
<img alt="../_images/scale_ens_time.png" class="align-center" src="../_images/scale_ens_time.png" />
<p>To replicate the benchmark, in the <code class="docutils literal notranslate"><span class="pre">mlens</span></code> benchmark folder, execute:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">python</span> <span class="n">scale_ens</span><span class="o">.</span><span class="n">py</span>

<span class="go">ML-ENSEMBLE</span>

<span class="go">Ensemble scale benchmark for datadimensioned up to (250000, 20)</span>
<span class="go">Available CPUs: 4</span>

<span class="go">Ensemble architecture</span>
<span class="go">Num layers: 2</span>
<span class="go">layer-1 | Estimators: [&#39;svr&#39;, &#39;randomforestregressor&#39;, &#39;gradientboostingregressor&#39;, &#39;lasso&#39;, &#39;mlpregressor&#39;].</span>
<span class="go">layer-2 | Meta Estimator: lasso</span>

<span class="go">SCORES (TIME TO FIT)</span>
<span class="go">Sample size</span>
<span class="go">      20000 SuperLearner : 0.807 ( 19.83s) | BlendEnsemble : 0.823 (  4.09s) | Subsemble : 0.789 (  9.84s) |</span>
<span class="go">      40000 SuperLearner : 0.396 ( 42.94s) | BlendEnsemble : 0.462 ( 11.37s) | Subsemble : 0.777 ( 28.49s) |</span>
<span class="go">      60000 SuperLearner : 0.280 ( 75.08s) | BlendEnsemble : 0.328 ( 23.43s) | Subsemble : 0.570 ( 56.93s) |</span>
<span class="go">      80000 SuperLearner : 0.310 (126.59s) | BlendEnsemble : 0.414 ( 41.75s) | Subsemble : 0.434 ( 90.66s) |</span>
<span class="go">     100000 SuperLearner : 0.447 (180.77s) | BlendEnsemble : 0.308 ( 63.80s) | Subsemble : 0.541 (111.31s) |</span>
<span class="go">     120000 SuperLearner : 0.306 (243.34s) | BlendEnsemble : 0.281 ( 92.71s) | Subsemble : 0.323 (129.15s) |</span>
<span class="go">     140000 SuperLearner : 0.269 (312.58s) | BlendEnsemble : 0.408 (107.19s) | Subsemble : 0.303 (165.86s) |</span>
<span class="go">     160000 SuperLearner : 0.298 (410.33s) | BlendEnsemble : 0.312 (145.76s) | Subsemble : 0.343 (234.12s) |</span>
<span class="go">     180000 SuperLearner : 0.250 (614.27s) | BlendEnsemble : 0.279 (195.74s) | Subsemble : 0.272 (295.76s) |</span>
<span class="go">     200000 SuperLearner : 0.301 (594.41s) | BlendEnsemble : 0.390 (208.11s) | Subsemble : 0.260 (265.42s) |</span>
<span class="go">     220000 SuperLearner : 0.280 (787.79s) | BlendEnsemble : 0.260 (251.45s) | Subsemble : 0.407 (356.17s) |</span>
<span class="go">     240000 SuperLearner : 0.304 (928.15s) | BlendEnsemble : 0.299 (314.76s) | Subsemble : 0.300 (459.59s) |</span>
<span class="go">     260000 SuperLearner : 0.252 (1226.66s) | BlendEnsemble : 0.273 (350.77s) | Subsemble : 0.279 (462.97s) |</span>
<span class="go">Benchmark done | 04:20:34</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Sebastian Flennerhag.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.2.2',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>